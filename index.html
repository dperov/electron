<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ö–∞—Ä—Ç–∏–Ω–∫–æViewer Tabs</title>
  <style>
    html, body {height: 100%; margin:0; padding:0; background:#171717; overflow:hidden;}
    #topbar {padding:8px; background:#2a2a2a; color:#fff;}
    #tabs {
      display: flex;
      background: #232323;
      overflow-x: auto;         /* –î–æ–±–∞–≤–ª–µ–Ω–æ: –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
      white-space: nowrap;      /* –ù–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å —Ç–∞–±—ã */
      scrollbar-color: #444 #232323; /* –î–ª—è Firefox */
      scrollbar-width: thin;
    }
    #tabs::-webkit-scrollbar {
      height: 8px;
      background: #232323;
    }
    #tabs::-webkit-scrollbar-thumb {
      background: #444;
      border-radius: 4px;
    }
    .tab {
      padding: 8px 14px; cursor:pointer; background:#333; color:#fff;
      border-right:1px solid #444; user-select:none;
      position:relative;
      flex: 0 0 auto;           /* –ù–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞—Ç—å —Ç–∞–±—ã */
      margin-right: 0px;
      white-space: nowrap;
    }
    .tab.active {background:#444;}
    .tab .tab-close {
      position:absolute;top:3px;right:6px; color:#ccc;font-weight:bold;cursor:pointer;
    }
    #addtab {font-weight:bold;padding:8px 13px;}
    #viewerArea { width: 100vw; height: 90vh; position: relative; background: #171717;}
    .imgbox {
      display:none;
      position:relative; /* –∏–∑–º–µ–Ω–µ–Ω–æ —Å absolute –Ω–∞ relative –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è overlay-canvas */
      left:0; top:0; width:100%; height:100%; cursor:grab;
      overflow:hidden;
    }
    .imgbox.active {display:block;}
    .imgbox img {user-select:none; pointer-events:none; will-change:transform;}
    #dropzone {
      position:absolute;left:0;top:0;width:100vw;height:100vh;display:none;
      z-index:10; background:rgba(0,0,0,0.20); color:white; font-size:2em; align-items:center;justify-content:center;
    }
    button {margin-left: 12px;}
    .crosshair-lines {
      pointer-events: none;
      position: absolute;
      left: 0; top: 0; width: 100%; height: 100%;
      z-index: 100;
    }
    .crosshair-lines .hline, .crosshair-lines .vline {
      position: absolute;
      background: #6cf;
      opacity: 0.7;
      pointer-events: none;
    }
    .crosshair-lines .hline {
      height: 1px;
      width: 100%;
    }
    .crosshair-lines .vline {
      width: 1px;
      height: 100%;
    }
    #toolpanel {
      position: absolute;
      left: 0;
      top: 0;
      width: 56px;
      height: 100vh;
      background: #232323;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 200;
      border-right: 1px solid #333;
    }
    body {
      padding-left: 56px; /* —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª—Å—è –ø–∞–Ω–µ–ª—å—é */
    }
    .color-swatch {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      cursor: pointer;
      border: 2.5px solid #888;
      box-sizing: border-box;
      background: #fff;
      transition: border 0.15s;
      margin: 0 auto;
      box-shadow: 0 0 0 2px #232323;
    }
    .color-swatch[data-color="#ff6"] { background: #ff6; }
    .color-swatch[data-color="#6cf"] { background: #6cf; }
    .color-swatch[data-color="#f66"] { background: #f66; }
    .color-swatch[data-color="#6f6"] { background: #6f6; }
    .color-swatch[data-color="#000"] { background: #000; }
    .color-swatch.selected {
      border: 3px solid #fff;
      box-shadow: 0 0 0 3px #4af;
    }
  </style>
</head>
<body>
  <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å–ª–µ–≤–∞ -->
  <div id="toolpanel">
    <button id="tool-line" title="–†–∏—Å–æ–≤–∞—Ç—å –ª–∏–Ω–∏—é" style="width:40px;height:40px;margin:8px 0;">/</button>
    <button id="tool-clear" title="–£–¥–∞–ª–∏—Ç—å –≤—Å—ë" style="width:40px;height:40px;margin:8px 0;">üóëÔ∏è</button>
    <!-- –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ -->
    <div id="color-palette" style="margin:16px 0;display:flex;flex-direction:column;gap:8px;">
      <div class="color-swatch" data-color="#ff6"></div>
      <div class="color-swatch" data-color="#6cf"></div>
      <div class="color-swatch" data-color="#f66"></div>
      <div class="color-swatch" data-color="#6f6"></div>
      <div class="color-swatch" data-color="#000"></div>
    </div>
  </div>
  <div id="statusbar" style="padding:8px;background:#222;color:#fff;display:flex;gap:20px;align-items:center;">
    <span>
      <button id="tool-open" class="mode-btn" title="–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª">üìÇ</button>
      <button id="mode-move" class="mode-btn active" title="–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ/–º–∞—Å—à—Ç–∞–± (V)">üñêÔ∏è</button>
      <button id="mode-rect" class="mode-btn" title="–í—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ (R)">‚¨õ</button>
      <button id="tool-fit" class="mode-btn" title="–ê–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫">‚õ∂</button>
      <button id="copy-rect" class="mode-btn" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–µ" disabled>üìã</button>
      <button id="set-transform" class="mode-btn" title="–ó–∞–¥–∞—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ" disabled>‚ÜîÔ∏è</button>
      <button id="mode-debug" class="mode-btn" title="–û—Ç–ª–∞–¥–∫–∞ SVG-—Å–ª–æ—è">üêû</button>
    </span>
    <span>X: <input id="coordX" type="text" readonly style="width:60px;background:#333;color:#fff;border:none;padding:2px 6px;"></span>
    <span>Y: <input id="coordY" type="text" readonly style="width:60px;background:#333;color:#fff;border:none;padding:2px 6px;"></span>
    <span>UserX: <input id="userX" type="text" readonly style="width:130px;background:#333;color:#8fd;border:none;padding:2px 6px;"></span>
    <span>UserY: <input id="userY" type="text" readonly style="width:70px;background:#333;color:#8fd;border:none;padding:2px 6px;"></span>
    <span>UserW: <input id="userW" type="text" readonly style="width:70px;background:#333;color:#8fd;border:none;padding:2px 6px;"></span>
    <span>UserH: <input id="userH" type="text" readonly style="width:70px;background:#333;color:#8fd;border:none;padding:2px 6px;"></span>
  </div>
  <div id="tabs"></div>
  <div id="viewerArea"></div>
  <div id="dropzone">–°–±—Ä–æ—Å—å—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞‚Ä¶</div>
  <div id="transform-modal" style="display:none;position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:1000;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;">
    <div style="background:#222;padding:24px 32px;border-radius:10px;box-shadow:0 0 20px #000;min-width:320px;">
      <h3 style="color:#fff;">–ó–∞–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</h3>
      <div style="color:#fff;margin-bottom:10px;">
        –í–≤–µ–¥–∏—Ç–µ –≥—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞:<br>
        (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ –∏ —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö)
      </div>
      <table style="color:#fff;margin-bottom:10px;">
        <tr><td></td><td>–ó–Ω–∞—á–µ–Ω–∏–µ</td></tr>
        <tr><td>–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å –Ω–∞—á–∞–ª–æ (X<sub>min</sub>)</td>
            <td><input id="ux0" type="datetime-local" style="width:170px"></td></tr>
        <tr><td>–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å –∫–æ–Ω–µ—Ü (X<sub>max</sub>)</td>
            <td><input id="ux1" type="datetime-local" style="width:170px"></td></tr>
        <tr><td>–í–µ—Ä—Ç–∏–∫–∞–ª—å –Ω–∞—á–∞–ª–æ (Y<sub>min</sub>)</td>
            <td><input id="uy0" style="width:80px"></td></tr>
        <tr><td>–í–µ—Ä—Ç–∏–∫–∞–ª—å –∫–æ–Ω–µ—Ü (Y<sub>max</sub>)</td>
            <td><input id="uy1" style="width:80px"></td></tr>
      </table>
      <button id="apply-transform">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
      <button id="cancel-transform">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
  <div id="statusline" style="position:fixed;left:0;bottom:0;width:100vw;height:28px;z-index:500;background:#181818;color:#fff;display:flex;align-items:center;font-size:15px;border-top:1px solid #333;">
    <span id="status-mode" style="min-width:140px;padding-left:18px;font-weight:bold;"></span>
    <span id="status-msg" style="flex:1;padding-left:24px;white-space:pre;"></span>
  </div>
  <script src="quad-transform.js"></script>
  <script src="renderer.js"></script>
</body>
</html>